# normalize.yaml
# Purpose:
# 1) text_replacements: applied BEFORE NER (token classification)
# 2) field_normalizations: applied AFTER NER aggregation (per field)
# 3) process_map: normalize Process_Type while preserving raw

version: "1.0"

# -----------------------------
# 1) Text-level replacements (pre-NER)
# -----------------------------
text_replacements:
  # Temperature code normalization (you specified: C0G -> NP0, prefer NP0)
  - pattern: '\bC0G\b'
    replace: 'NP0'
    flags: 'i'

  # Process wording normalization (for better consistency)
  # Keep in mind: you want raw+normalized output, so this is only for pre-NER help.
  - pattern: '\bSMD\b'
    replace: 'SMT'
    flags: 'i'

  # Common punctuation / separators cleanup (optional, safe)
  - pattern: '[，、]'
    replace: ','
    flags: ''

# -----------------------------
# 2) Field-level normalizations (post-NER)
#    Each item MUST be a dict with keys: field, pattern, replace (optional flags)
# -----------------------------
field_normalizations:
  # Package: normalize SOD-323HE -> SOD-323, keep only base part
  - field: 'Package'
    pattern: '(?i)\b(SOD-\d+)[A-Z]+\b'
    replace: '\1'
    flags: ''

  # Package: normalize SOT-xxx tail letters (e.g., SOT-232TR -> SOT-232)
  - field: 'Package'
    pattern: '(?i)\b(SOT-\d+)[A-Z]+\b'
    replace: '\1'
    flags: ''

  # Package: normalize SOT23-3 / SOT23-5 style to SOT23 (Pin_Count handled elsewhere)
  - field: 'Package'
    pattern: '(?i)\b(SOT\d{2})-\d+\b'
    replace: '\1'
    flags: ''

  # Temp_Coefficient: ensure C0G becomes NP0 (backup)
  - field: 'Temp_Coefficient'
    pattern: '\bC0G\b'
    replace: 'NP0'
    flags: 'i'

  # Process_Type: unify casing (backup)
  - field: 'Process_Type'
    pattern: '^(smt|smd|dip)$'
    replace: '\1'
    flags: 'i'

  # Resistance: unify ohm symbol variants (for Name20 readability; Code20 will be ASCII anyway)
  - field: 'Resistance'
    pattern: '(?i)\bohm\b'
    replace: 'Ω'
    flags: ''

# -----------------------------
# 3) Process normalization map (raw -> normalized)
#    run_bom.py will output:
#    - Process_Type_raw (original model output)
#    - Process_Type (mapped normalized)
# -----------------------------
process_map:
  SMD: SMT
  SMT: SMT
  DIP: DIP
